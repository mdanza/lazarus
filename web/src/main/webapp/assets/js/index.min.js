toastr.options={closeButton:false,debug:false,positionClass:"toast-top-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};var servicesUrl;$(document).ready(function(){servicesUrl=$("#servicesUrl").val();$("#forgotPasswordBtn").tooltip();setCustomValidationMessages();$("#loginForm").submit(function(c){$("#loginBtn").button("loading");var b=$(this);url=b.attr("action");var a=$.post(url,{username:$("#inputUsername").val(),password:$("#inputPassword").val()});a.done(function(d){jsonResponse=JSON.parse(d);if(jsonResponse.result=="OK"){$.ajax({url:"LoginServlet",type:"POST",data:{token:jsonResponse.data},success:function(f,g,e){$("#loginBtn").button("reset");if(f=="OK"){window.location.href="city-reports.jsp"}else{toastr.error("No se pudo completar su solicitud");$("#loginBtn").button("reset")}},error:function(e,g,f){toastr.error("No se pudo completar su solicitud");$("#loginBtn").button("reset")}})}else{$("#loginBtn").button("reset");toastr.error(jsonResponse.data)}});return false})});function registerUser(){$("#registerBtn").button("loading");var c=$("#newUserForm");url=c.attr("action");var d=$("#inputNewUsername");var b=$("#inputNewPassword");var a=$("#inputNewEmail");if(d.get(0).checkValidity()&b.get(0).checkValidity()&a.get(0).checkValidity()){$.ajax({url:servicesUrl+"/users/username/"+d.val(),type:"GET",success:function(f,g,e){jsonResponse=JSON.parse(f);if(jsonResponse.result=="OK"&&jsonResponse.data=="false"){$.ajax({url:servicesUrl+"/users/email/"+a.val(),type:"GET",success:function(j,k,i){jsonResponse=JSON.parse(j);if(jsonResponse.result=="OK"&&jsonResponse.data=="false"){var h=$.post(url,{username:d.val(),password:b.val(),email:a.val()});h.done(function(l){jsonResponse=JSON.parse(l);if(jsonResponse.result=="OK"){toastr.success("Usuario creado con éxito");$("#inputUsername").val($("#inputNewUsername").val());$("#inputPassword").val($("#inputNewPassword").val());$("#loginForm").submit()}else{$("#registerBtn").button("reset");toastr.error(jsonResponse.data)}})}else{$("#registerBtn").button("reset");toastr.error("Email ya está en uso")}},error:function(h,j,i){$("#registerBtn").button("reset");toastr.error("No se pudo completar su solicitud")}})}else{$("#registerBtn").button("reset");toastr.error("Nombre de usuario ya está en uso")}},error:function(e,g,f){toastr.error("No se pudo completar su solicitud")}})}else{$("#registerBtn").button("reset")}return false}function forgotPassword(){if($("#inputUsername").val()!=""){toastr.info("Se está procesando su solicitud..");$.ajax({url:servicesUrl+"/users/password",type:"POST",data:{username:$("#inputUsername").val()},success:function(b,c,a){jsonResponse=JSON.parse(b);if(jsonResponse.result=="OK"){toastr.success("Se ha enviado un email a su casilla de correo con la nueva contraseña")}else{toastr.error(jsonResponse.data)}},error:function(a,c,b){toastr.error("No se pudo completar su solicitud")}})}else{toastr.warning("Ingrese su nombre de usuario")}}function setCustomValidationMessages(){var a=document.getElementsByTagName("form");for(var b=0;b<a.length;b++){a[b].addEventListener("invalid",function(c){c.preventDefault();toastr.error("Campo "+c.target.placeholder+" vacío o con formato incorrecto")},true)}};